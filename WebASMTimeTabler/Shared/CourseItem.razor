@using WebASMTimeTabler.Models
@using Microsoft.AspNetCore.Components

<tr @key="Course.ClassNumber" class="@GetSelectedClass()">
    <td>
        <input type="checkbox" checked="@IsSelected" @onclick="ToggleCourse" />
    </td>
    <td>@Course.Grade</td>
    <td>@Course.Credit</td>
    <td>@Course.CourseID</td>
    <td>@Course.CourseNumber</td>
    <td>@Course.Division</td>
    <td>@Course.ClassNumber</td>
    <td>@string.Join(", ", Course.Times)</td>
    <td>@Course.Name</td>
    <td>
        @if (HasMultipleProfessors)
        {
            <span @onclick="ToggleProfessorPopup" style="cursor:pointer; text-decoration:underline; color:blue;">
                @FirstProfessor <span style="font-size:0.8em;">외</span>
            </span>
            <CourseProfessorPopup Course="Course" Visible="showProfessorPopup" OnClose="CloseProfessorPopup" />
        }
        else
        {
            @Course.Professor
        }
    </td>
    <td>@Course.Time</td>
</tr>

@code{
    [Parameter] public Course Course { get; set; } = default!;
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public EventCallback<Course> OnToggleSelection { get; set; }

    private bool showProfessorPopup = false;

    private void ToggleCourse() => OnToggleSelection.InvokeAsync(Course);

    private void ToggleProfessorPopup()
    {
        showProfessorPopup = !showProfessorPopup;
    }

    private void CloseProfessorPopup() => showProfessorPopup = false;

    private string GetSelectedClass() => IsSelected ? "table-primary" : "";

    // 문자열 처리 캐싱
    private bool HasMultipleProfessors => Course.Professor.Contains(",");
    private string FirstProfessor => Course.Professor.Split(',')[0];
}
